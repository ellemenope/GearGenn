<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GearGen Demo — Polished Mockups</title>

<!-- Quick fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

<!-- minimal reset + styling -->
<style>
  :root{
    --bg:#f3f6f9; --card:#ffffff; --accent:#0d6efd; --accent-2:#ff6b3a; --muted:#6b7280;
    --shadow: 0 8px 24px rgba(17,24,39,.08);
  }
  html,body{height:100%; margin:0; font-family:Inter,system-ui,Segoe UI,Arial; background:var(--bg); color:#111;}
  .wrap { max-width:1180px; margin:28px auto; padding:28px; }
  h1 { margin:0 0 8px 0; font-weight:700; font-size:24px; color:#0b1220; }
  p.lead { margin:6px 0 18px 0; color:var(--muted); }

  /* 3-card mockups container */
  .mockups {
    display:flex; gap:22px; align-items:flex-start; justify-content:center; flex-wrap:wrap;
  }

  .card {
    width: 320px; background:var(--card); border-radius:12px; box-shadow:var(--shadow); padding:18px;
    border:1px solid #eef2f6; text-align:center; display:flex; flex-direction:column; align-items:stretch;
  }
  .card .title { font-weight:700; font-size:13px; color:#222; margin-bottom:10px; text-transform:uppercase; letter-spacing:.6px;}
  .card .frame { background:#fbfdff; border-radius:8px; height:260px; display:flex; align-items:center; justify-content:center; border:1px dashed #e6eef6; overflow:hidden; position:relative; }
  .caption { margin-top:12px; font-weight:700; font-size:14px; color:#111; line-height:1.25; }
  .sub { font-size:13px; color:var(--muted); margin-top:6px; font-weight:600; }

  /* input UI styles (left card) */
  .form { display:flex; flex-direction:column; gap:10px; align-items:stretch; }
  label { display:block; font-size:13px; color:var(--muted); font-weight:600; margin-bottom:6px; }
  input[type=number], input[type=text] { padding:10px 12px; border-radius:8px; border:1px solid #e6eef6; font-size:14px; }
  .btn { background:var(--accent); color:#fff; border:none; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700; box-shadow:0 6px 18px rgba(13,110,253,.14); }
  .btn.secondary { background:transparent; color:var(--accent); border:1px solid rgba(13,110,253,.12); box-shadow:none; font-weight:700; }
  .meta { font-size:12px; color:var(--muted); margin-top:10px; }

  /* SVG container (center card) specifics */
  #svgCanvas svg { width:100%; height:100%; }

  /* 3D preview (#preview3d uses canvas appended by three.js) */
  #preview3d { width:100%; height:100%; background: linear-gradient(180deg,#1b1f24,#0f1113); border-radius:8px; position:relative; overflow:hidden; }

  /* small footer row of action buttons */
  .actions { display:flex; gap:8px; margin-top:12px; justify-content:center; }
  .actions button { padding:8px 12px; border-radius:8px; border:1px solid #e6eef6; background:#fff; cursor:pointer; font-weight:600; }

  /* responsive */
  @media (max-width:1000px) {
    .mockups{flex-direction:column; align-items:center;}
    .card{width:92%;}
  }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Prototype Mockups</h1>
    <p class="lead">Interactive demo — input values on the left auto-generate the CAD drawing in the center and the interactive 3D preview on the right.</p>

    <div class="mockups" aria-live="polite">
      <!-- LEFT: Input UI -->
      <div class="card" aria-label="Input Interface">
        <div class="title">Mockup 1</div>
        <div class="frame" style="padding:14px;">
          <div style="width:100%; max-width:240px;">
            <form id="inputForm" class="form" onsubmit="return false;">
              <div>
                <label for="torque">Torque (N·m)</label>
                <input id="torque" type="number" value="100" min="0">
              </div>
              <div>
                <label for="rpm">RPM</label>
                <input id="rpm" type="number" value="1500" min="0">
              </div>
              <div>
                <label for="ratio">Gear ratio (z2:z1)</label>
                <input id="ratio" type="text" value="3:1">
              </div>
              <div>
                <label for="module">Module (mm)</label>
                <input id="module" type="number" value="2" min="0.5" step="0.1">
              </div>
              <div>
                <label for="z1">Teeth on pinion (z1) — optional</label>
                <input id="z1" type="number" placeholder="Auto">
              </div>

              <div style="display:flex; gap:8px; margin-top:10px;">
                <button id="generateBtn" class="btn" type="button">Generate Gear</button>
                <button id="presetBtn" class="btn secondary" type="button">Use Preset</button>
              </div>

              <div class="meta">Outputs: pitch diameter (PD), center distance, SVG CAD drawing, and interactive 3D preview.</div>
            </form>
          </div>
        </div>

        <div class="caption">Input Interface<br><span class="sub">(Torque, RPM, Gear ratio)</span></div>
      </div>

      <!-- CENTER: Generated CAD drawing (SVG) -->
      <div class="card" aria-label="Generated CAD Drawing">
        <div class="title">Mockup 2</div>
        <div id="svgCanvas" class="frame" aria-hidden="false" role="img" title="Generated 2D CAD drawing">
          <!-- SVG will be injected here -->
        </div>

        <div style="display:flex; justify-content:center; gap:8px; margin-top:10px;">
          <button id="downloadSvg" class="actions-btn actions" style="border:none; background:transparent;">Download SVG</button>
        </div>

        <div class="caption">Generated CAD Drawing<br><span class="sub">(spur gear)</span></div>
      </div>

      <!-- RIGHT: 3D Model Preview (Three.js) -->
      <div class="card" aria-label="3D Model Preview">
        <div class="title">Mockup 3</div>
        <div id="preview3d" class="frame" style="padding:0; height:260px;">
          <!-- three.js canvas will be appended here -->
        </div>

        <div style="display:flex; justify-content:center; gap:8px; margin-top:10px;">
          <button id="downloadPng" class="actions">Download PNG</button>
          <button id="downloadObj" class="actions">Export OBJ (demo)</button>
        </div>

        <div class="caption">3D Model Preview<br><span class="sub">Interactive (rotate / zoom)</span></div>
      </div>
    </div>
  </div>

  <!-- Three.js (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
  <script>
/* ---------- Utilities & gear math (same core logic upgraded for UI) ---------- */

function parseRatio(r) {
  r = (''+r).trim();
  if (r.includes(':')) {
    const [a,b] = r.split(':').map(s=>Number(s));
    if (!isNaN(a) && !isNaN(b) && b!==0) return a/b;
  }
  const n = Number(r);
  return (isNaN(n) || n===0) ? 2 : n;
}

function chooseZ1(ratio) {
  // choose a reasonable z1 between 12 and 32 that yields integer z2
  for (let cand=12;cand<=32;cand++){
    const z2 = Math.round(cand * ratio);
    if (Math.abs(z2/cand - ratio) < 1e-9) return cand;
  }
  // fallback
  return 20;
}

function compute(params) {
  let { torque, rpm, ratioInput, module, z1 } = params;
  torque = Number(torque)||0; rpm = Number(rpm)||0; module = Number(module)||2;
  const ratio = parseRatio(ratioInput);
  if (!z1) { z1 = chooseZ1(ratio); } else z1 = Math.max(8, Math.round(Number(z1)));
  const z2 = Math.max(8, Math.round(z1 * ratio));
  const pd1 = module * z1; const pd2 = module * z2;
  const center = (pd1 + pd2) / 2;
  return { torque, rpm, ratio, module, z1, z2, pd1:pd1.toFixed(2), pd2:pd2.toFixed(2), center:center.toFixed(2) };
}

/* ---------- SVG generator (polished, scaled to frame) ---------- */
function createGearSVG(teeth, module, bore=12) {
  const teethNum = Number(teeth);
  const pd = teethNum * module;
  const scale = 4; // visual scale factor for preview
  const R = (pd/2) * scale;
  const outer = R + module*scale*0.6;
  const inner = R - module*scale*0.6;
  const toothAngle = (2*Math.PI)/teethNum;
  const size = Math.max(360, outer*2.6);
  const xmlns = "http://www.w3.org/2000/svg";
  const svg = document.createElementNS(xmlns,'svg');
  svg.setAttribute('viewBox', `${-size/2} ${-size/2} ${size} ${size}`);
  svg.setAttribute('role','img');
  svg.setAttribute('aria-label','Generated spur gear drawing');

  // background grid subtle
  const bg = document.createElementNS(xmlns,'rect');
  bg.setAttribute('x', -size/2); bg.setAttribute('y', -size/2); bg.setAttribute('width', size); bg.setAttribute('height', size);
  bg.setAttribute('fill','#fbfdff');
  svg.appendChild(bg);

  // group for teeth
  const g = document.createElementNS(xmlns,'g');
  g.setAttribute('transform','translate(0,0)');
  for (let i=0;i<teethNum;i++){
    const a = i*toothAngle;
    const a1 = a + 0.18*toothAngle;
    const a2 = a - 0.18*toothAngle;
    const x1 = outer*Math.cos(a2), y1 = outer*Math.sin(a2);
    const x2 = outer*Math.cos(a1), y2 = outer*Math.sin(a1);
    const x3 = inner*Math.cos(a1), y3 = inner*Math.sin(a1);
    const x4 = inner*Math.cos(a2), y4 = inner*Math.sin(a2);

    const path = document.createElementNS(xmlns,'path');
    path.setAttribute('d',`M ${x1} ${y1} L ${x2} ${y2} L ${x3} ${y3} L ${x4} ${y4} Z`);
    path.setAttribute('fill','#e6eef6');
    path.setAttribute('stroke','#2b2f34');
    path.setAttribute('stroke-width',1);
    g.appendChild(path);
  }
  svg.appendChild(g);

  // center hole/hub
  const hub = document.createElementNS(xmlns,'circle');
  hub.setAttribute('cx','0'); hub.setAttribute('cy','0'); hub.setAttribute('r', Math.max(8,bore) * scale);
  hub.setAttribute('fill','#ffffff'); hub.setAttribute('stroke','#0f1113'); hub.setAttribute('stroke-width',1.2);
  svg.appendChild(hub);

  // descriptive text
  const txt = document.createElementNS(xmlns,'text');
  txt.setAttribute('x', -size/2 + 12);
  txt.setAttribute('y', -size/2 + 22);
  txt.setAttribute('font-size',12);
  txt.setAttribute('fill','#333');
  txt.textContent = `Teeth: ${teethNum} • Module: ${module} • PD: ${pd.toFixed(2)} mm`;
  svg.appendChild(txt);

  return svg;
}

/* ---------- Download helpers ---------- */
function downloadBlob(filename, content, type) {
  const blob = new Blob([content], {type});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = filename; a.click();
  URL.revokeObjectURL(url);
}

/* ---------- Three.js 3D preview ---------- */
let renderer, scene, camera, controls, gearMesh;

function initThree(container) {
  container.innerHTML = '';
  renderer = new THREE.WebGLRenderer({antialias:true, alpha:true});
  renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
  renderer.setSize(container.clientWidth, container.clientHeight);
  container.appendChild(renderer.domElement);

  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(40, container.clientWidth/container.clientHeight, 0.1, 4000);
  camera.position.set(0, 200, 400);

  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.dampingFactor = 0.08;

  const hemi = new THREE.HemisphereLight(0xffffff, 0x111111, 0.6);
  scene.add(hemi);
  const dir = new THREE.DirectionalLight(0xffffff, 0.9);
  dir.position.set(200, 300, 200);
  scene.add(dir);

  animate();
  window.addEventListener('resize', ()=> {
    renderer.setSize(container.clientWidth, container.clientHeight);
    camera.aspect = container.clientWidth/container.clientHeight;
    camera.updateProjectionMatrix();
  });
}

function animate() {
  requestAnimationFrame(animate);
  if (controls) controls.update();
  if (renderer && scene && camera) renderer.render(scene, camera);
}

function buildGearMesh(teeth, module, thickness=18, bore=12) {
  const scale = 3.6;
  const pd = teeth * module;
  const R = (pd/2) * scale;
  const outer = R + module*scale*0.6;
  const inner = R - module*scale*0.6;
  const shape = new THREE.Shape();
  const toothAngle = (2*Math.PI)/teeth;
  const pts = [];
  for (let i=0;i<teeth;i++){
    const a = i*toothAngle;
    const a2 = a - 0.18*toothAngle;
    const a1 = a + 0.18*toothAngle;
    pts.push(new THREE.Vector2(outer*Math.cos(a2), outer*Math.sin(a2)));
    pts.push(new THREE.Vector2(outer*Math.cos(a1), outer*Math.sin(a1)));
    pts.push(new THREE.Vector2(inner*Math.cos(a1), inner*Math.sin(a1)));
    pts.push(new THREE.Vector2(inner*Math.cos(a2), inner*Math.sin(a2)));
  }
  shape.moveTo(pts[0].x, pts[0].y);
  for (let i=1;i<pts.length;i++) shape.lineTo(pts[i].x, pts[i].y);
  shape.closePath();

  const hole = new THREE.Path();
  const holeR = Math.max(8,bore) * scale;
  const seg = 32;
  for (let i=0;i<seg;i++){
    const a = (i/seg)*Math.PI*2;
    const x = holeR*Math.cos(a), y = holeR*Math.sin(a);
    if (i===0) hole.moveTo(x,y); else hole.lineTo(x,y);
  }
  hole.closePath();
  shape.holes.push(hole);

  const extrudeSettings = { depth: thickness, bevelEnabled:true, bevelThickness:1.1, bevelSize:1.1, bevelSegments:2 };
  const geom = new THREE.ExtrudeGeometry(shape, extrudeSettings);
  geom.center();
  const mat = new THREE.MeshStandardMaterial({ color:0xbfc8cf, metalness:0.95, roughness:0.2 });
  const mesh = new THREE.Mesh(geom, mat);
  mesh.rotation.x = -Math.PI/2;
  return mesh;
}

/* ---------- UI wiring ---------- */
const svgCanvas = document.getElementById('svgCanvas');
const preview3d = document.getElementById('preview3d');
const generateBtn = document.getElementById('generateBtn');
const presetBtn = document.getElementById('presetBtn');
const downloadSvg = document.getElementById('downloadSvg');
const downloadPng = document.getElementById('downloadPng');
const downloadObj = document.getElementById('downloadObj');

initThree(preview3d);

// initial render with defaults
function renderDemo() {
  const params = {
    torque: document.getElementById('torque').value,
    rpm: document.getElementById('rpm').value,
    ratioInput: document.getElementById('ratio').value,
    module: document.getElementById('module').value,
    z1: document.getElementById('z1').value || null
  };
  const res = compute(params);

  // create svg and insert (center)
  const svg = createGearSVG(res.z2, res.module);
  svgCanvas.innerHTML = '';
  svgCanvas.appendChild(svg);

  // attach SVG download
  downloadSvg.onclick = ()=> {
    const serializer = new XMLSerializer();
    const str = serializer.serializeToString(svg);
    downloadBlob('gear_cad.svg', str, 'image/svg+xml');
  };

  // recreate 3D mesh
  if (gearMesh) { scene.remove(gearMesh); gearMesh.geometry.dispose(); gearMesh.material.dispose(); gearMesh = null; }
  gearMesh = buildGearMesh(res.z2, res.module, 18, 12);
  scene.add(gearMesh);

  // finalize camera framing
  const box = new THREE.Box3().setFromObject(gearMesh);
  const size = box.getSize(new THREE.Vector3()).length();
  const center = box.getCenter(new THREE.Vector3());
  controls.target.copy(center);
  camera.position.set(center.x, center.y + Math.max(size*0.6, 120), center.z + Math.max(size*0.9, 240));
  camera.updateProjectionMatrix();

  // PNG export
  downloadPng.onclick = ()=> {
    renderer.render(scene, camera);
    const data = renderer.domElement.toDataURL('image/png');
    const a = document.createElement('a'); a.href = data; a.download = 'gear_preview.png'; a.click();
  };

  // demo OBJ exporter (approximate) - client side: convert geometry to simple OBJ text
  downloadObj.onclick = ()=> {
    // simple geometry serialization (no materials) - for demo only
    const geom = gearMesh.geometry;
    geom.computeVertexNormals();
    let output = '';
    const pos = geom.attributes.position.array;
    const normals = geom.attributes.normal.array;
    let vCount = 1;
    for (let i=0;i<pos.length;i+=3){
      output += `v ${pos[i]} ${pos[i+1]} ${pos[i+2]}\n`;
    }
    for (let i=0;i<normals.length;i+=3){
      output += `vn ${normals[i]} ${normals[i+1]} ${normals[i+2]}\n`;
    }
    for (let i=0;i<pos.length/3;i+=3){
      output += `f ${i+1}//${i+1} ${i+2}//${i+2} ${i+3}//${i+3}\n`;
    }
    downloadBlob('gear_demo.obj', output, 'text/plain');
  };

  // update accessible ARIA label
  svg.setAttribute('aria-label', `Spur gear with ${res.z2} teeth, module ${res.module} mm, PD ${res.pd2} mm`);
}

// presets for demo
presetBtn.addEventListener('click', ()=> {
  document.getElementById('torque').value = 120;
  document.getElementById('rpm').value = 1200;
  document.getElementById('ratio').value = '4:1';
  document.getElementById('module').value = 2;
  document.getElementById('z1').value = '';
  renderDemo();
});

generateBtn.addEventListener('click', renderDemo);

// initial call
renderDemo();

  </script>
</body>
</html>
